#!/usr/bin/env python
#coding:utf-8
"""
  Author:  Wusf --<wushifan221@gmail.com>
  Purpose: 
  Created: 2015/11/24
"""

import os,sys
import sqlite3 as lite
from ConfigParser import ConfigParser
root = os.path.abspath(__file__).split("PyQuantStrategy")[0]+"PyQuantStrategy"
sys.path.append(root)

#----------------------------------------------------------------------
def GenQuarterlyFinRptData(srcDbName,rptDateFieldName):
    """
    将本地原始财报数据中的
    Income Statement 表和
    Cashflow Statement 表
    整理成季度数据
    """
    configPath = "\\Configs\\DatabaseConfigs\\"
    dbCfg = ConfigParser()
    dbCfg.optionxform = str 
    dbCfgFile = "DbInfo.cfg"
    dbCfg.read(root + configPath + dbCfgFile)    
    
    locDbPath = dbCfg.get("Local", "RawEquityData")
    conn = lite.connect(locDbPath+srcDbPath)
    conn.text_factory = str
    cur = conn.cursor()
    cur.execute("SELECT name FROM SQLITE_MASTER WHERE TYPE='table' ")
    rows = cur.fetchall()
    tbNames = []
    for row in rows:
        tbNames.append(row[0])
        
    for tbName in tbNames:
        if tbName=="IncomeStatement" or tbName=="CashFlowStatement":
            rptDates = []
            cur.execute("SELECT DISTINCT {} FROM {} ORDER BY {} ASC".format(rptDateFieldName,tbName,rptDateFieldName))
            rows = cur.fetchall()
            for row in rows:
                rptDates.append(row[0])
            for i in xrange(1,len(rptDates)):
                if rptDates[i][4:] == "0331":
                    print rptDates[i]
                
            



if __name__ == "__main__":
    srcDbPath = "FinRptData\\FinRptData_Wind_CICC.db"
    rptDateFieldName = "rpt_date" 
    GenQuarterlyFinRptData(srcDbPath,rptDateFieldName)



